#!/bin/bash

HEROKU_APP="gitcatgo-staging"
CURRENT_BRANCH=$TRAVIS_BRANCH

if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then
    echo "Pull request detected"
    HEROKU_APP="gitcatgo-pullrequest"
	CURRENT_BRANCH=$TRAVIS_PULL_REQUEST

    cp servers/pullrequest.txt servers/server.txt
    ./bin/mysql_empty_pullDB
else
    cp servers/staging.txt servers/server.txt
    ./bin/mysql_empty_stagingDB
fi

echo "Current branch: "
echo $CURRENT_BRANCH

echo "Heroku app used: "
echo $HEROKU_APP

heroku git:remote -a $HEROKU_APP -r staging
git push -fu staging $CURRENT_BRANCH:master
